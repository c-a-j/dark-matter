---
import { render } from "astro:content";
import type { CollectionEntry } from "astro:content";
import PostLayout from "../../layouts/PostLayout.astro";
import { getCollectionStaticPaths } from "../../lib/utils";
import { getPaginationInfo } from "../../lib/utils";

import type { BaseSchema } from "../../content.config";
import type { ContentFrontmatter } from "../../lib/types";

interface Props {
  entry: CollectionEntry<"posts">;
}

export async function getStaticPaths() {
  return await getCollectionStaticPaths("posts");
}

const { entry: post } = Astro.props as Props;
const { Content, headings } = await render(post);
const data = post.data as BaseSchema;

const paginationInfo = await getPaginationInfo({
  url: Astro.url.pathname,
  collectionName: "posts",
  isSubcollection: data.isSubcollection,
});
const frontmatter = { ...data, url: Astro.url.pathname } as ContentFrontmatter;
---

<PostLayout
  frontmatter={frontmatter}
  headings={headings}
  collectionName="posts"
  paginationInfo={paginationInfo}
>
  <Content />
</PostLayout>
